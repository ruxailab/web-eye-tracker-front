# Auto-label issues (bug, enhancement, good first issue, maintainer vs contributor)
name: Auto-label issues

on:
  issues:
    types: [opened, edited]

permissions:
  issues: write

jobs:
  label:
    runs-on: ubuntu-latest
    steps:
      - name: Label issue
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const title = (issue.title || '').toLowerCase();
            const body = (issue.body || '').toLowerCase();
            const text = title + ' ' + body;

            const labelsToAdd = [];

            if (/\b(bug|fix|broken|error|fixes)\b/.test(text)) {
              labelsToAdd.push('bug');
            }
            if (/\b(feature|enhancement|improvement)\b/.test(text)) {
              labelsToAdd.push('enhancement');
            }
            if (/\b(doc|readme|documentation)\b/.test(text)) {
              labelsToAdd.push('documentation');
            }
            if (/\b(good first issue|first issue|starter)\b/.test(text)) {
              labelsToAdd.push('good first issue');
            }

            if (/\[maintainer\]|maintainer only|internal\b/.test(text)) {
              labelsToAdd.push('maintainer-only');
            } else {
              labelsToAdd.push('contributor-friendly');
            }

            const existing = (issue.labels || []).map(l => l.name);
            const toAdd = labelsToAdd.filter(l => !existing.includes(l));
            if (toAdd.length === 0) return;

            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              labels: toAdd
            });
