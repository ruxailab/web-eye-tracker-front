# Welcome new contributors (per project doc: "Pull requests are welcome. Found a bug? Open an issue.")
name: Welcome new contributors

on:
  issues:
    types: [opened]
  pull_request:
    types: [opened]

permissions:
  issues: write
  pull-requests: write

jobs:
  welcome:
    runs-on: ubuntu-latest
    steps:
      - name: Welcome on first issue
        if: github.event_name == 'issues'
        uses: actions/github-script@v7
        with:
          script: |
            const author = context.payload.issue.user.login;
            const repo = context.repo;
            const { data: issueData } = await github.rest.search.issuesAndPullRequests({
              q: `repo:${repo.owner}/${repo.repo} is:issue author:${author}`
            });
            const isFirstIssue = issueData.total_count <= 1;
            const welcome = isFirstIssue
              ? 'Welcome to the project! '
              : '';
            const body = welcome + 'Thanks for opening this issue. Pull requests are welcomeâ€”see [CONTRIBUTING](https://github.com/' + repo.owner + '/' + repo.repo + '/blob/main/CONTRIBUTING.md) for guidelines. Found a bug? Describe steps to reproduce and we\'ll label it.';
            await github.rest.issues.createComment({
              owner: repo.owner,
              repo: repo.repo,
              issue_number: context.payload.issue.number,
              body
            });

      - name: Welcome on first PR
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          script: |
            const author = context.payload.pull_request.user.login;
            const repo = context.repo;
            const { data: prData } = await github.rest.search.issuesAndPullRequests({
              q: `repo:${repo.owner}/${repo.repo} is:pr author:${author}`
            });
            const isFirstPR = prData.total_count <= 1;
            const welcome = isFirstPR
              ? 'Welcome to the project! '
              : '';
            const body = welcome + 'Thanks for your pull request. See [CONTRIBUTING](https://github.com/' + repo.owner + '/' + repo.repo + '/blob/main/CONTRIBUTING.md) for guidelines. We\'ll review as soon as we can.';
            await github.rest.issues.createComment({
              owner: repo.owner,
              repo: repo.repo,
              issue_number: context.payload.pull_request.number,
              body
            });
